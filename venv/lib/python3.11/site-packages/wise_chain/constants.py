from wise_chain.config import Env

PRODUCTION_CLUSTER = 'mlp-euc1-pe-main01'
STAGING_CLUSTER = 'mlp-euc1-se-main01'
LLM_GATEWAY_DEFAULT_URL = 'https://llm-gateway.tw.ee'
LLM_GATEWAY_ENVOY_URL = 'http://llm-gateway.main.envoy.tw.ee:10101'
LLM_GATEWAY_MLP_PRODUCTION_K8S_URL = f'https://llm-gateway-proxy.{PRODUCTION_CLUSTER}.wisek8s.io'
LLM_GATEWAY_MLP_STAGING_K8S_URL = f'https://llm-gateway-proxy.{STAGING_CLUSTER}.wisek8s.io'
MAX_CLAUDE_OUTPUT_TOKENS = 4096


def get_gateway_url(service_or_user: str, ml_prod: bool) -> str:
    """Gets the URL for the LLM Gateway based on the service_or_user and ml_prod flags

    Parameters
    ----------
    service_or_user : str
        Whether a user or service is communicating with the LLM Gateway

    ml_prod : bool
        Whether the request is coming from ml-prod environment

    Returns
    -------
    str
        The URL for the LLM Gateway

    Raises
    ------
    ValueError
        If the service_or_user flag is not 'user', or 'service'
    """
    env = Env.infer()
    use_proxy = ml_prod

    if use_proxy and (env == env.PROD or env == env.LOCAL):
        return LLM_GATEWAY_MLP_PRODUCTION_K8S_URL

    if service_or_user == 'user' and env == env.LOCAL and use_proxy:
        return LLM_GATEWAY_MLP_PRODUCTION_K8S_URL

    if use_proxy and env == env.STAGING:
        return LLM_GATEWAY_MLP_STAGING_K8S_URL

    if service_or_user == 'user':
        return LLM_GATEWAY_DEFAULT_URL

    elif service_or_user == 'service':
        return LLM_GATEWAY_ENVOY_URL

    raise ValueError(f'Invalid service_or_user flag: {service_or_user}')
