import anthropic

from wise_chain.auth.authorizer import get_llm_gateway_authorizer

authorizer = get_llm_gateway_authorizer()
authorizer.authorize()

if authorizer.credential is None:
    raise ValueError('Authorization failed: No credential available')

BASE_URL = 'https://llm-gateway.tw.ee'

custom_headers = {
    'Content-Type': 'application/json',
    'x-envoy-upstream-rq-timeout-ms': '30000',
    'x-wise-llm-gateway-use-case': 'your-use-case',
    'x-wise-llm-gateway-team': 'your-team',
}

client = anthropic.Anthropic(
    auth_token=authorizer.credential.id_token,
    base_url=f'{BASE_URL}/api/v2/anthropic',
    default_headers=custom_headers,
)

message = client.messages.create(
    model='us.anthropic.claude-3-7-sonnet-20250219-v1:0',
    max_tokens=1024,
    messages=[{'role': 'user', 'content': 'Why is the ocean so deep and blue?'}],
)
print(message.content)
