from __future__ import annotations

from functools import wraps
from typing import Dict, List

from wise_chain.embeddings.gateway_wrapper import GatewayEmbeddingsWrapper
from wise_chain.exceptions import UnknkownModelIdError
from wise_chain.llms.gateway_wrapper import GatewayLLMWrapper


class LLMRegistry:
    registry: Dict[str, GatewayLLMWrapper | GatewayEmbeddingsWrapper] = {}

    @classmethod
    def get(cls, model_id: str):
        try:
            return cls.registry[model_id]
        except KeyError as exc:
            raise UnknkownModelIdError(f'The model id {model_id} is not yet supported.') from exc

    @classmethod
    def register(cls, model_ids: List[str]):
        @wraps(cls)
        def decorator(llm):
            for model_id in model_ids:
                cls.registry[model_id] = llm
            return llm

        return decorator
