import webbrowser
from urllib.parse import urlencode

from wise_chain.auth.pkce_secret import PKCESecret


def open_authorization_endpoint(
    endpoint: str,
    client_id: str,
    redirect_uri: str,
    state: str,
    scope: str,
    pkce_secret: PKCESecret,
) -> None:
    """Direct the user agent to an OAuth 2.1 authorization server."""
    params = {
        'client_id': client_id,
        'redirect_uri': redirect_uri,
        'response_type': 'code',
        'state': state,
        'scope': scope,
        'code_challenge': pkce_secret.challenge,
        'code_challenge_method': pkce_secret.challenge_method,
    }
    webbrowser.open(f'{endpoint}?{urlencode(params)}')
